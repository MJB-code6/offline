!function(){function emptyQueue(){var openRequest=indexedDB.open("DEFERRED",1);openRequest.onsuccess=function(e){var db=e.target.result,objectStore=db.transaction(["deferredRequests"],"readwrite").objectStore("deferredRequests"),request=objectStore.get(window.location.origin);request.onerror=function(e){},request.onsuccess=function(event){for(var deferredQueue=request.result.requests;navigator.onLine&&deferredQueue.length;){var nextRequest=deferredQueue.shift(),deferredFunc=eval(nextRequest.callback);"function"==typeof deferredFunc&&deferredFunc(JSON.parse(nextRequest.data));var requestUpdate=objectStore.put({domain:window.location.origin,requests:deferredQueue});requestUpdate.onerror=function(e){},requestUpdate.onsuccess=function(e){}}}}}function sendToSW(e){serviceWorker?serviceWorker.postMessage(e):navigator.serviceWorker.oncontrollerchange=function(){serviceWorker=navigator.serviceWorker.controller,serviceWorker.postMessage(e)}}if(navigator.serviceWorker){var db,serviceWorker=navigator.serviceWorker.controller;serviceWorker||navigator.serviceWorker.register("/sw-skyport.min.js",{scope:"."}).then(function(e){serviceWorker=e.active||e.waiting||e.installing,skyport.cache(["/skyport.min.js"]),sendToSW({command:"createDB",info:window.location.origin})}),window.skyport=window.skyport||{cache:function(e,n){sendToSW({command:"cache",info:e}),n&&sendToSW({command:"fallback",info:n})},fallback:function(e){sendToSW({command:"fallback",info:e})},sendOrQueue:function(e,n){return navigator.onLine?n(e):void("function"==typeof n&&sendToSW({command:"queue",info:{domain:window.location.origin,dataObj:JSON.stringify(e),deferredFunc:"("+n.toString()+")"}}))}},window.addEventListener("online",function(e){sendToSW({command:"online",info:!0}),emptyQueue()}),window.addEventListener("offline",function(e){sendToSW({command:"online",info:!1})}),window.addEventListener("load",function(e){})}}();
